<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut Acme</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#configuration"><strong>2</strong><span>Configuration</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#challenges"><strong>3</strong><span>Challenge Types</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-configuration"><a href="#configuration"><strong>2</strong><span>Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-challenges"><a href="#challenges"><strong>3</strong><span>Challenge Types</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-http"><a href="#http"><strong>3.1</strong><span>HTTP-01</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-tls"><a href="#tls"><strong>3.2</strong><span>TLS-APLN-01</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-dns"><a href="#dns"><strong>3.3</strong><span>DNS-01</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut Acme</h1>
        <p></p>
        <p>Extensions to integrate Micronaut and Acme</p>
        <p><strong>Version:</strong> <select style='max-width: 200px' onChange='window.document.location.href=this.options[this.selectedIndex].value;'><option selected='selected' value='https://micronaut-projects.github.io/micronaut-acme/snapshot/guide/index.html'>1.0.0.BUILD-SNAPSHOT</option></select></p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-acme/edit/master/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports <a href="https://en.wikipedia.org/wiki/Automated_Certificate_Management_Environment">ACME</a> via the <code>micronaut-acme</code> module.</p>
</div>
<div class="sect2">
<h3 id="_release_history">Release History</h3>
<div class="sect3">
<h4 id="_1_0_0">1.0.0</h4>
<div class="ulist">
<ul>
<li>
<p>Initial Release.</p>
<div class="ulist">
<ul>
<li>
<p>Support for ordering, renewing and automatically installing certificates.</p>
</li>
<li>
<p>Validating challenges using http, tls and dns (limited) challenges.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>

<h1 id="configuration"><a class="anchor" href="#configuration"></a>2 Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-acme/edit/master/src/main/docs/guide/configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut 1.3.0 or above is required and you must have the <code>micronaut-acme</code> dependency on your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.acme:micronaut-acme:1.0.0.BUILD-SNAPSHOT")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.acme&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-acme&lt;/artifactId&gt;
    &lt;version&gt;1.0.0.BUILD-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</p>
</div>
<div class="paragraph">
<p>The <code>micronaut-acme</code> module transitively includes the <code>org.shredzone.acme4j:acme4j-client</code> and <code>org.shredzone.acme4j:acme4j-utils</code> dependency.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    server:
        ssl:
            enabled: true <i class="conum" data-value="1"></i><b>(1)</b>
    acme:
        enabled: true <i class="conum" data-value="2"></i><b>(2)</b>
        tos-agree: true <i class="conum" data-value="3"></i><b>(3)</b>
        cert-location: /path/to/store/certificates <i class="conum" data-value="4"></i><b>(4)</b>
        domain: domain.com <i class="conum" data-value="5"></i><b>(5)</b>
        refresh:
            delay: 1m <i class="conum" data-value="6"></i><b>(6)</b>
            frequency: 24h <i class="conum" data-value="7"></i><b>(7)</b>
        domain-key: | <i class="conum" data-value="8"></i><b>(8)</b>
            -----BEGIN RSA PRIVATE KEY-----
            MIIEowIBAAKCAQEAi32GgrNvt5sYonmvFRs1lYMdUTsoFHz33knzsTvBRb+S1JCc
            al86zAx3dRdFiLyWw4/lXmS6oS5B/NT1w9R7nW3vd0oi4ump/QjWjOd8SxCBqMcR
            ....
            MIIEowIBAAKCAQEAi32GgrNvt5sYonmvFRs1lYMdUTsoFHz33knzsTvBRb+S1JCc
            al86zAx3dRdFiLyWw4/lXmS6oS5B/NT1w9R7nW3vd0oi4ump/QjWjOd8SxCBqMcR
            -----END RSA PRIVATE KEY-----
        account-key: | <i class="conum" data-value="9"></i><b>(9)</b>
            -----BEGIN RSA PRIVATE KEY-----
            MIIEowIBAAKCAQEAi32GgrNvt5sYonmvFRs1lYMdUTsoFHz33knzsTvBRb+S1JCc
            al86zAx3dRdFiLyWw4/lXmS6oS5B/NT1w9R7nW3vd0oi4ump/QjWjOd8SxCBqMcR
            ....
            MIIEowIBAAKCAQEAi32GgrNvt5sYonmvFRs1lYMdUTsoFHz33knzsTvBRb+S1JCc
            al86zAx3dRdFiLyWw4/lXmS6oS5B/NT1w9R7nW3vd0oi4ump/QjWjOd8SxCBqMcR
            -----END RSA PRIVATE KEY-----
        acme-server: acme://server.com <i class="conum" data-value="10"></i><b>(10)</b>
        order:
            pause: 3s <i class="conum" data-value="11"></i><b>(11)</b>
            refresh-attempts: 10 <i class="conum" data-value="14"></i><b>(14)</b>
        auth:
            pause: 1m <i class="conum" data-value="13"></i><b>(13)</b>
            refresh-attempts: 10 <i class="conum" data-value="14"></i><b>(14)</b>
        renew-within: 30 <i class="conum" data-value="15"></i><b>(15)</b>
        challenge-type: [http,tls,dns] <i class="conum" data-value="16"></i><b>(16)</b>
        refresh:  <i class="conum" data-value="17"></i><b>(17)</b>
            frequency: 24h
            delay: 24h</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Enables ssl for micronaut.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enables ACME integration for micronaut. Default is <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Agrees to the Terms of Service of the ACME provider. Default is <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Location to store certificate on the server.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Domain name for the certificate. Can with be a singular domain name (ex. domain.com) or a wildcard domain name (*.domain.com)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>How long to wait until the server starts up the ACME background process. Default is <code>1 minute</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>How often the server will check for a new ACME cert and refresh it if needed. Default is <code>24 hours</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Private key used to encrypt the certificate. <strong>DO NOT CHECK THIS IN TO SOURCE CODE</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Private key used to when setting up your accoutn with the ACME provider. <strong>DO NOT CHECK THIS IN TO SOURCE CODE</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Url of the ACME server (ex. acme://letsencrypt.org/staging)</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Time to wait in between polling order status of the ACME server. Default is <code>3 seconds</code></td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Number of times to poll an order status of the ACME server. Default is <code>10</code></td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Time to wait in between polling authorization status of the ACME server. Default is <code>3 seconds</code></td>
</tr>
<tr>
<td><i class="conum" data-value="14"></i><b>14</b></td>
<td>Number of times to poll an authorization status of the ACME server. Default is <code>10</code></td>
</tr>
<tr>
<td><i class="conum" data-value="15"></i><b>15</b></td>
<td>Number of days before the process will start to try to refresh the certificate from the ACME provider. Default is <code>30 days</code></td>
</tr>
<tr>
<td><i class="conum" data-value="16"></i><b>16</b></td>
<td>The challenge type you would like to use. Default is <code>tls</code></td>
</tr>
<tr>
<td><i class="conum" data-value="17"></i><b>17</b></td>
<td>The interval to check on if the certificate needs to be refreshed. Default is 24h (aka daily)</td>
</tr>
</table>
</div>

<h1 id="challenges"><a class="anchor" href="#challenges"></a>3 Challenge Types</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-acme/edit/master/src/main/docs/guide/challenges.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>ACME supports 3 different challenge types which will be used to validate that you in fact own the domain before a certificate is issued.</p>
</div>

<h2 id="http"><a class="anchor" href="#http"></a>3.1 HTTP-01</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-acme/edit/master/src/main/docs/guide/challenges/http.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Utilizing <code>http</code> challenge type you will need to do one of the following two things :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>enable dual protocol support</p>
</li>
<li>
<p>setup redirect from http &#8594; https in any load balancer/proxy server you have in front of your application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The reason for this is that Let&#8217;s Encrypt for example will only call out to
the http challenge type over http and nothing else but will follow redirects.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">acme:
  challenge-type: 'http'

micronaut:
  server:
    dual-protocol: true</code></pre>
</div>
</div>

<h2 id="tls"><a class="anchor" href="#tls"></a>3.2 TLS-APLN-01</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-acme/edit/master/src/main/docs/guide/challenges/tls.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Utilizing <code>tls</code> challenge type is the simpliest to configure and thus the default because you will only be required
to open up the default secure port for the server to allow the challenge server to validate it.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">acme:
  challenge-type: 'tls'</code></pre>
</div>
</div>

<h2 id="dns"><a class="anchor" href="#dns"></a>3.3 DNS-01</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-acme/edit/master/src/main/docs/guide/challenges/dns.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Utilizing <code>dns</code> challenge type allows validation to be done via entry of a DNS TXT record. Currently
the application will log out a message that looks as follows.</p>
</div>
<div class="listingblock">
<div class="title">DNS output</div>
<div class="content">
<pre class="highlightjs highlight"><code>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
							CREATE DNS `TXT` ENTRY AS FOLLOWS
				_acme-challenge.example.com with value 79ZNJaxlcLYIFootHL6Rrbh2VUCfFGgPeurVyjoRrS8
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is output you will need to log into your DNS provider and create a TXT entry with the following key and value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>key: <code>_acme-challenge.example.com</code></p>
</li>
<li>
<p>value: <code>79ZNJaxlcLYIFootHL6Rrbh2VUCfFGgPeurVyjoRrS8</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since this is a manual process you will also want to bump out your <code>acme.auth.pause</code> duration so that there is enough time between retries
and time take for the manual entry/DNS propagation.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">acme:
  challenge-type: 'dns'
  auth:
    # Due to the current manual nature in which the dns validation has to be done currently
    # we change the amount of time we wait before trying to authorize again to make sure there
    # is time for us logging into the dns interface, setting a TXT record and waiting for it
    # to propagate.
    pause: 2m</code></pre>
</div>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>